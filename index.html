<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Yearly Habit Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <style>
        .heatmap {
            display: grid;
            grid-template-columns: repeat(53, 25px); /* 52 weeks + 1 for alignment purposes, each column 25px wide */
            grid-template-rows: repeat(7, 25px); /* 7 days of the week, each row 25px high */
            grid-gap: 2px;
        }
        .day {
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid #ccc;
        }
        .completed {
            background-color: #4CAF50; /* Green for days with completed habits */
        }
        .day-label {
            writing-mode: vertical-rl;
            text-align: center;
            font-weight: bold;
            height: 25px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
<div id="app">
    <div v-for="week in calculateWeeksOfYear(currentYear)" :key="week.start">
        <div v-for="date in week.days" :key="date" 
            :class="['day', { 'completed': checkIfHabitDone(date) }]" 
            @click="toggleHabit(date)">
            {{ new Date(date).getDate() }}
        </div>
    </div>
</div>

<script>
new Vue({
    el: '#app',
    data: {
        currentYear: new Date().getFullYear(),
        habits: localStorage.getItem('habits') ? JSON.parse(localStorage.getItem('habits')) : []
    },
    methods: {
        calculateWeeksOfYear(year) {
            let startDate = new Date(year, 0, 1);
            let endDate = new Date(year, 11, 31);
            let weeks = [];
            let days = [];

            // Start the array with empty slots until the first day of the year
            for (let i = 0; i < startDate.getDay(); i++) {
                days.push(null);
            }

            while (startDate <= endDate) {
                if (startDate.getDay() === 0 && days.length) {
                    weeks.push({start: days[0], days: days.map(date => date ? date.toISOString().substring(0, 10) : null)});
                    days = [];
                }
                days.push(new Date(startDate));
                startDate.setDate(startDate.getDate() + 1);
            }

            // Push the last week
            if (days.length) {
                weeks.push({start: days[0], days: days.map(date => date ? date.toISOString().substring(0, 10) : null)});
            }

            return weeks;
        },
        checkIfHabitDone(date) {
            const dateString = date.toISOString().substring(0, 10);
            return this.habits.includes(dateString);
        },
        toggleHabit(date) {
            const dateString = date.toISOString().substring(0, 10);
            const index = this.habits.indexOf(dateString);
            if (index > -1) {
                this.habits.splice(index, 1);
            } else {
                this.habits.push(dateString);
            }
            this.saveHabits();
        },
        saveHabits() {
            localStorage.setItem('habits', JSON.stringify(this.habits));
        }
    }
});
</script>
</body>
</html>
